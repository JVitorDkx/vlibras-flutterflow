<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>VLibras Dinâmico</title>
</head>
<body>

<div vw class="enabled">
  <div vw-access-button class="active"></div>
  <div vw-plugin-wrapper>
    <div class="vw-plugin-top-wrapper"></div>
  </div>
</div>

<script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>

<script>
  // captura ?w=palavra
  function getWordFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get("w");
  }

  // espera o CANVAS do avatar existir
  function waitForAvatar(callback, timeout = 15000) {
    const start = Date.now();

    const interval = setInterval(() => {
      const canvas = document.querySelector(
        ".vw-plugin-top-wrapper canvas"
      );

      if (canvas && window.VLibras?.Widget?.instance) {
        clearInterval(interval);
        callback();
      }

      if (Date.now() - start > timeout) {
        clearInterval(interval);
        console.error("Avatar VLibras não inicializou");
      }
    }, 300);
  }

  // inicialização padrão
  new window.VLibras.Widget("https://vlibras.gov.br/app");

  waitForAvatar(() => {
    const palavra = getWordFromURL();
    if (palavra) {
      console.log("Traduzindo:", palavra);
      window.VLibras.Widget.instance.translate(palavra);
    }
  });
</script>

</body>
</html>
